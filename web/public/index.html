<html>
<head>
<title>sean's room</title>
<style type="text/css">

body {
	background: black;
	transition: background-color 0.5s;
	font-family: monospace;
	color: white;
}

#buttons div {
	transition: background-color 0.2s;
	position: fixed;
	width: 23%;
	height: 70%;
	top: 15%;
}

#a {
	left: 5%;
}
#b {
	left: 38%;
}
#c {
	left: 71%;
}
</style>
</head>
<body>
<script src="/core-client.js"></script>
<script src="./jquery-2.0.3.min.js"></script>
<div id="buttons">
	<div id="a"></div>
	<div id="b"></div>
	<div id="c"></div>
</div>
<script>
var Core = require('core-client');
var core = new Core();

core.on('ready', function() {
	var Button = function(relayid) {
		var device = core.motor.devices[relayid];
		var state = 0;

		var update = function(newstate){
			state = newstate;
			var color = newstate == 1 ? '#ffc000' : '#000000';
			$("#" + relayid).css({
				"background": color,
			});
		}
		this.getstate = function(){ return state };
		this.askstate = device.commands.getstate;
		this.update = update;
		this.toggle = function() {
			device.commands.toggle();
			update(state^1);
		};
		$("#" + relayid).click(this.toggle);
		this.askstate();

	}
	core.motor.io.on('message', function(msg) {
		try{
			var button = buttons[msg.name];
			button.update(msg.state);
		} catch(e){console.error(e)};
		var sum = buttons.a.getstate() + buttons.b.getstate() + buttons.c.getstate();
		var colors = ["#000000", "#333333", "#444444", "#555555"];
		$("body").css({"background": colors[sum]});
	});

	var buttons = {
		a: new Button("a"),
		b: new Button("b"),
		c: new Button("c")
	}


	$(document).keypress(function(e) {
		var code = e.keyCode || e.which;
		if (code == 49){
			buttons.a.toggle();
		}
		if (code == 50){
			buttons.b.toggle();
		}
		if (code == 51){
			buttons.c.toggle();
		}
	});
});

</script>
</body>
</html>
