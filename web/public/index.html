<html>
<head>
<title>dora shell</title>
<style type="text/css">

body {
	transition: background-color 0.5s ease;
	font-family: monospace;
	color: white;
}

p {
	font-weight: bold;
}

#buttons div {
	transition: background-color 0.2s ease;
	position: fixed;
	width: 23%;
	height: 70%;
	top: 15%;
}

#a {
	left: 5%;
}
#b {
	left: 38%;
}
#c {
	left: 71%;
}

b {
	font-size: xx-large;
}
a {
	color: #959796;
	text-decoration: none;
}
</style>
</head>
<body>
<script src="/core-client/core-client.js"></script>
<script src="./jquery-2.0.3.min.js"></script>
<div id="buttons">
	<div id="a"></div>
	<div id="b"></div>
	<div id="c"></div>
</div>
<script>
var Core = require('core-client');
var core = new Core();

core.on('ready', function() {
	var Button = function(relayid) {
		var device = core.motor.devices[relayid];

		var updateState = function(cb) {
			device.commands.getstate(function(data) {
				cb(data);
			});
		}
		var changeModel = function(data){
			var color = data.state == 1 ? '#f2cb08' : '#000000';
			$("#" + relayid).css({
				"background": color,
			});
		}

		//initialize colors
		updateState(changeModel);


		this.device = device;
		this.updateState = updateState;
		this.changeModel = changeModel;

		this.toggle = function() {
			device.commands.toggle();
			updateState(changeModel);
		}

		$("#" + relayid).click(this.toggle);

	}
	var a = new Button("a");
	var b = new Button("b");
	var c = new Button("c");

	setInterval(function() {
		a.updateState(function(data) {
			a.changeModel(data);
			a.state = data.state;
		});
		b.updateState(function(data) {
			b.changeModel(data);;
			b.state = data.state;
		});
		c.updateState(function(data) {
			c.changeModel(data);;
			c.state = data.state;
		});

		var sum = a.state + b.state + c.state;
		var colors = ["#000000", "#333333", "#999999", "#dddddd"];

		$("body").css({"background": colors[sum]});
	}, 100);


	$(document).keypress(function(e) {
		var code = e.keyCode || e.which;
		if (code == 49){
			a.toggle();
		}
		if (code == 50){
			b.toggle();
		}
		if (code == 51){
			c.toggle();
		}
	});
});

</script>
</body>
</html>
