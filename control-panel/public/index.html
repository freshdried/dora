<html>
<head>
<title>living-space control panel</title>
<script src="/sensory/sensory/socket.io/socket.io.js"></script>
<style type="text/css">
body{
	margin: 0;
	padding: 0;

	background: #ebebeb;
	overflow: hidden;
}

#terminal {
	margin: 0px;
	padding: 0px;

	height: 100%;
	width: 100%;


	overflow: hidden;
	word-wrap: break-word;
	background: #252726;
	color:#d8d8d8;
	font-family: monospace;
	font-size: 20px;
}
#terminal-output {
	padding: 0px;
	margin: 0px;
	width: 100%;
}
#terminal-inputline{
	width: 100%;
	display: inline;
}
.prompt {
	color: #ffac18;
	margin: 0px;
	width: auto;
}
#terminal-input {
	background: transparent;
	border: none;
	outline: none;
	width: 90%;
	margin: 0px;
	color: inherit;
	font-family: monospace;
	font-size: 20px;
}
</style>
</head>
<body>

<div id="terminal">
	<pre id="terminal-output"></pre>
	<span id="terminal-inputline">
		<span class="prompt">$ </span><input type="text" id=terminal-input autofocus>
	</span>
</div>

<script>
var terminal = new function(){
	var output = document.getElementById('terminal-output');
	var inputline = document.getElementById('terminal-inputline');
	this.print = function(str){
		output.insertAdjacentHTML('beforeEnd', str);
		inputline.scrollIntoView();
	};
	this.println = function(str){
		output.insertAdjacentHTML('beforeEnd', str + "\n");
		inputline.scrollIntoView();
	};
	this.clear = function(){
		output.innerHTML = "";
	};

};
terminal.println("Welcome to the Room Control Shell!");
terminal.println("Type help for help");
var commands = {
	help: function(args){
		for( i in commands){
			terminal.println(i);
		};
	},
	clear: terminal.clear
}
//TODO: fix wrap on overflow
var input = document.getElementById('terminal-input');
input.onkeypress = function(e){
	var keycode = e.keycode || e.which;
	if (keycode == '13'){
		var args = input.value.split(" ");
		terminal.println('<span class="prompt">$ </span>' + input.value);

		if (input.value.replace(/ /g, '') == ''){
		}else if (args[0] in commands){
			commands[args[0]](args.slice(1));
		}else{
			terminal.println("command not found: " + args[0]);
		};
		input.value = "";
	};
};

/*
var motor = new function(){
	var socket = io.connect('/motor', { resource: 'motor/socket.io'});
	var devices = {};
	socket.on('info', function(data){
		terminal.println('Connected to motor.js');
		devices = data;
	});

	this.socket = socket;
	this.devices = devices;
}
*/

var sensory = new function(){
        var socket = io.connect('/', { resource: 'sensory/socket.io'});
	var devices = {};
	socket.on('info', function(data){
		terminal.println('Connected to sensory.js');
		devices = data;
	});

	this.socket = socket;
	this.devices = devices;
}




</script>
</body>
</html>
